local Library = {}

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "RainbowCustomLib"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

function Library:CreateWindow(title)
    title = title or "My Hub"

    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "Main"
    mainFrame.Size = UDim2.fromOffset(200, 200)
    mainFrame.Position = UDim2.new(0.5, -100, 0.5, -100)
    mainFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 30)
    mainFrame.BorderSizePixel = 0
    mainFrame.ClipsDescendants = true
    mainFrame.Parent = screenGui

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = mainFrame

    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(90, 170, 255)
    stroke.Thickness = 1.4
    stroke.Transparency = 0.55
    stroke.Parent = mainFrame

    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, 0, 0, 36)
    titleBar.BackgroundColor3 = Color3.fromRGB(32, 32, 42)
    titleBar.BorderSizePixel = 0
    titleBar.Parent = mainFrame

    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 10)
    titleCorner.Parent = titleBar

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -50, 1, 0)
    titleLabel.Position = UDim2.new(0, 12, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.fromRGB(210, 210, 255)
    titleLabel.TextSize = 15
    titleLabel.Font = Enum.Font.GothamSemibold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleBar

    local close = Instance.new("TextButton")
    close.Size = UDim2.fromOffset(28, 28)
    close.Position = UDim2.new(1, -34, 0, 4)
    close.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    close.Text = "X"
    close.TextColor3 = Color3.new(1,1,1)
    close.Font = Enum.Font.GothamBold
    close.TextSize = 15
    close.Parent = titleBar

    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 6)
    closeCorner.Parent = close

    close.MouseButton1Click:Connect(function()
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Size = UDim2.new(0,0,0,0),
            BackgroundTransparency = 1
        })
        tween:Play()
        tween.Completed:Connect(function()
            screenGui:Destroy()
        end)
    end)

    local scrolling = Instance.new("ScrollingFrame")
    scrolling.Name = "Content"
    scrolling.Size = UDim2.new(1, -16, 1, -46)
    scrolling.Position = UDim2.new(0, 8, 0, 40)
    scrolling.BackgroundTransparency = 1
    scrolling.BorderSizePixel = 0
    scrolling.ScrollBarThickness = 5
    scrolling.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 160)
    scrolling.ScrollBarImageTransparency = 0.3
    scrolling.ScrollingEnabled = true
    scrolling.ScrollingDirection = Enum.ScrollingDirection.Y
    scrolling.CanvasSize = UDim2.new(0, 0, 0, 0)  -- akan diupdate otomatis
    scrolling.Parent = mainFrame

    local listLayout = Instance.new("UIListLayout")
    listLayout.Padding = UDim.new(0, 8)
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.FillDirection = Enum.FillDirection.Vertical
    listLayout.Parent = scrolling

    local padding = Instance.new("UIPadding")
    padding.PaddingTop = UDim.new(0, 4)
    padding.PaddingBottom = UDim.new(0, 8)
    padding.PaddingLeft = UDim.new(0, 4)
    padding.PaddingRight = UDim.new(0, 8)
    padding.Parent = scrolling

    local function updateCanvas()
        local contentHeight = listLayout.AbsoluteContentSize.Y
        scrolling.CanvasSize = UDim2.new(0, 0, 0, contentHeight + 20)
    end

    listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvas)
    scrolling:GetPropertyChangedSignal("AbsoluteCanvasSize"):Connect(updateCanvas)  -- extra safety

    local dragging, dragStart, startPos
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    local window = {}

    function window:Section(sectionName)
        sectionName = sectionName or "Section"

        local sectionFrame = Instance.new("Frame")
        sectionFrame.Name = "Section"
        sectionFrame.Size = UDim2.new(1, 0, 0, 32)
        sectionFrame.BackgroundTransparency = 1
        sectionFrame.Parent = scrolling

        local sectionTitle = Instance.new("TextLabel")
        sectionTitle.Size = UDim2.new(1, 0, 0, 26)
        sectionTitle.BackgroundTransparency = 1
        sectionTitle.Text = sectionName
        sectionTitle.TextColor3 = Color3.fromRGB(170, 170, 255)
        sectionTitle.TextSize = 14
        sectionTitle.Font = Enum.Font.GothamSemibold
        sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
        sectionTitle.Parent = sectionFrame

        local container = Instance.new("Frame")
        container.Name = "Container"
        container.Size = UDim2.new(1, 0, 1, -30)
        container.Position = UDim2.new(0, 0, 0, 30)
        container.BackgroundTransparency = 1
        container.Parent = sectionFrame

        local containerLayout = Instance.new("UIListLayout")
        containerLayout.Padding = UDim.new(0, 7)
        containerLayout.SortOrder = Enum.SortOrder.LayoutOrder
        containerLayout.FillDirection = Enum.FillDirection.Vertical
        containerLayout.Parent = container

        local section = {}

        local function updateSection()
            sectionFrame.Size = UDim2.new(1, 0, 0, containerLayout.AbsoluteContentSize.Y + 36)
            updateCanvas()
        end
        containerLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateSection)

        function section:Button(text, callback)
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1, 0, 0, 34)
            btn.BackgroundColor3 = Color3.fromRGB(55, 130, 240)
            btn.Text = text or "Button"
            btn.TextColor3 = Color3.new(1,1,1)
            btn.Font = Enum.Font.GothamSemibold
            btn.TextSize = 13
            btn.Parent = container

            local c = Instance.new("UICorner", btn)
            c.CornerRadius = UDim.new(0, 6)

            btn.MouseButton1Click:Connect(callback or function() end)

            updateSection()
            return btn
        end

        function section:Label(text)
            local lbl = Instance.new("TextLabel")
            lbl.Size = UDim2.new(1, 0, 0, 22)
            lbl.BackgroundTransparency = 1
            lbl.Text = text or ""
            lbl.TextColor3 = Color3.fromRGB(190, 190, 220)
            lbl.TextSize = 13
            lbl.Font = Enum.Font.Gotham
            lbl.TextXAlignment = Enum.TextXAlignment.Left
            lbl.Parent = container

            updateSection()
            return lbl
        end

        function section:Toggle(text, default, callback)
            default = default or false
            callback = callback or function() end

            local toggleFrame = Instance.new("Frame")
            toggleFrame.Size = UDim2.new(1, 0, 0, 34)
            toggleFrame.BackgroundTransparency = 1
            toggleFrame.Parent = container

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0.65, 0, 1, 0)
            label.BackgroundTransparency = 1
            label.Text = text or "Toggle"
            label.TextColor3 = Color3.fromRGB(210, 210, 230)
            label.TextSize = 13
            label.Font = Enum.Font.GothamSemibold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = toggleFrame

            local indicator = Instance.new("Frame")
            indicator.Size = UDim2.fromOffset(44, 24)
            indicator.Position = UDim2.new(1, -54, 0.5, -12)
            indicator.BackgroundColor3 = default and Color3.fromRGB(60, 200, 100) or Color3.fromRGB(80, 80, 90)
            indicator.Parent = toggleFrame

            local indCorner = Instance.new("UICorner", indicator)
            indCorner.CornerRadius = UDim.new(1, 0)

            local circle = Instance.new("Frame")
            circle.Size = UDim2.fromOffset(20, 20)
            circle.Position = default and UDim2.new(0, 22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10)
            circle.BackgroundColor3 = Color3.new(1,1,1)
            circle.Parent = indicator

            local circleCorner = Instance.new("UICorner", circle)
            circleCorner.CornerRadius = UDim.new(1, 0)

            local value = default

            local function updateToggle()
                if value then
                    TweenService:Create(indicator, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 200, 100)}):Play()
                    TweenService:Create(circle, TweenInfo.new(0.2), {Position = UDim2.new(0, 22, 0.5, -10)}):Play()
                else
                    TweenService:Create(indicator, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(80, 80, 90)}):Play()
                    TweenService:Create(circle, TweenInfo.new(0.2), {Position = UDim2.new(0, 2, 0.5, -10)}):Play()
                end
            end

            toggleFrame.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    value = not value
                    updateToggle()
                    callback(value)
                end
            end)

            updateToggle()
            updateSection()

            return { Toggle = function(v) value = v updateToggle() callback(v) end, Value = function() return value end }
        end

        function section:Slider(text, min, max, default, step, callback)
            min = min or 0 max = max or 100 default = math.clamp(default or min, min, max) step = step or 1 callback = callback or function() end

            local sliderFrame = Instance.new("Frame")
            sliderFrame.Size = UDim2.new(1, 0, 0, 48)
            sliderFrame.BackgroundTransparency = 1
            sliderFrame.Parent = container

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -60, 0, 20)
            label.BackgroundTransparency = 1
            label.Text = text or "Slider"
            label.TextColor3 = Color3.fromRGB(210, 210, 230)
            label.TextSize = 13
            label.Font = Enum.Font.GothamSemibold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = sliderFrame

            local valueLabel = Instance.new("TextLabel")
            valueLabel.Size = UDim2.fromOffset(50, 20)
            valueLabel.Position = UDim2.new(1, -58, 0, 0)
            valueLabel.BackgroundTransparency = 1
            valueLabel.Text = tostring(default)
            valueLabel.TextColor3 = Color3.fromRGB(180, 255, 180)
            valueLabel.TextSize = 13
            valueLabel.Font = Enum.Font.Gotham
            valueLabel.Parent = sliderFrame

            local bar = Instance.new("Frame")
            bar.Size = UDim2.new(1, 0, 0, 8)
            bar.Position = UDim2.new(0, 0, 0, 28)
            bar.BackgroundColor3 = Color3.fromRGB(50, 50, 65)
            bar.Parent = sliderFrame

            local barCorner = Instance.new("UICorner", bar)
            barCorner.CornerRadius = UDim.new(1, 0)

            local fill = Instance.new("Frame")
            fill.Size = UDim2.new((default - min)/(max - min), 0, 1, 0)
            fill.BackgroundColor3 = Color3.fromRGB(90, 180, 255)
            fill.Parent = bar

            local fillCorner = Instance.new("UICorner", fill)
            fillCorner.CornerRadius = UDim.new(1, 0)

            local knob = Instance.new("Frame")
            knob.Size = UDim2.fromOffset(18, 18)
            knob.Position = UDim2.new((default - min)/(max - min), -9, 0.5, -9)
            knob.BackgroundColor3 = Color3.fromRGB(220, 220, 255)
            knob.Parent = bar

            local knobCorner = Instance.new("UICorner", knob)
            knobCorner.CornerRadius = UDim.new(1, 0)

            local value = default

            local function updateSlider(newVal)
                value = math.clamp(math.round(newVal / step) * step, min, max)
                valueLabel.Text = tostring(value)
                local ratio = (value - min) / (max - min)
                fill.Size = UDim2.new(ratio, 0, 1, 0)
                knob.Position = UDim2.new(ratio, -9, 0.5, -9)
                callback(value)
            end

            local draggingSlider = false

            bar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    draggingSlider = true
                end
            end)

            bar.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    draggingSlider = false
                end
            end)

            RunService.RenderStepped:Connect(function()
                if draggingSlider then
                    local mousePos = UserInputService:GetMouseLocation()
                    local relativeX = math.clamp((mousePos.X - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
                    local newVal = min + (max - min) * relativeX
                    updateSlider(newVal)
                end
            end)

            updateSlider(default)
            updateSection()

            return { Set = function(v) updateSlider(v) end, Get = function() return value end }
        end

        function section:Dropdown(text, options, default, callback)
            options = options or {}
            default = default or (options[1] or "None")
            callback = callback or function() end

            local ddFrame = Instance.new("Frame")
            ddFrame.Size = UDim2.new(1, 0, 0, 34)
            ddFrame.BackgroundTransparency = 1
            ddFrame.Parent = container

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0.4, 0, 1, 0)
            label.BackgroundTransparency = 1
            label.Text = text or "Dropdown"
            label.TextColor3 = Color3.fromRGB(210, 210, 230)
            label.TextSize = 13
            label.Font = Enum.Font.GothamSemibold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = ddFrame

            local selectedBtn = Instance.new("TextButton")
            selectedBtn.Size = UDim2.new(0.6, 0, 1, 0)
            selectedBtn.Position = UDim2.new(0.4, 0, 0, 0)
            selectedBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
            selectedBtn.Text = default
            selectedBtn.TextColor3 = Color3.new(1,1,1)
            selectedBtn.Font = Enum.Font.Gotham
            selectedBtn.TextSize = 13
            selectedBtn.TextTruncate = Enum.TextTruncate.SplitWord
            selectedBtn.Parent = ddFrame

            local ddCorner = Instance.new("UICorner", selectedBtn)
            ddCorner.CornerRadius = UDim.new(0, 6)

            local listFrame = Instance.new("Frame")
            listFrame.Size = UDim2.new(0.6, 0, 0, 0)
            listFrame.Position = UDim2.new(0.4, 0, 1, 4)
            listFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
            listFrame.Visible = false
            listFrame.Parent = ddFrame

            local listCorner = Instance.new("UICorner", listFrame)
            listCorner.CornerRadius = UDim.new(0, 6)

            local listLayoutDD = Instance.new("UIListLayout")
            listLayoutDD.Padding = UDim.new(0, 3)
            listLayoutDD.SortOrder = Enum.SortOrder.LayoutOrder
            listLayoutDD.Parent = listFrame

            local function openDropdown()
                listFrame.Visible = true
                TweenService:Create(listFrame, TweenInfo.new(0.18), {Size = UDim2.new(0.6, 0, 0, #options * 32 + 6)}):Play()
            end

            local function closeDropdown()
                TweenService:Create(listFrame, TweenInfo.new(0.18), {Size = UDim2.new(0.6, 0, 0, 0)}):Play()
                task.delay(0.19, function() listFrame.Visible = false end)
            end

            selectedBtn.MouseButton1Click:Connect(function()
                if listFrame.Visible then closeDropdown() else openDropdown() end
            end)

            for _, opt in ipairs(options) do
                local optBtn = Instance.new("TextButton")
                optBtn.Size = UDim2.new(1, 0, 0, 30)
                optBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
                optBtn.Text = opt
                optBtn.TextColor3 = Color3.new(1,1,1)
                optBtn.Font = Enum.Font.Gotham
                optBtn.TextSize = 13
                optBtn.Parent = listFrame

                local optCorner = Instance.new("UICorner", optBtn)
                optCorner.CornerRadius = UDim.new(0, 5)

                optBtn.MouseButton1Click:Connect(function()
                    selectedBtn.Text = opt
                    closeDropdown()
                    callback(opt)
                end)
            end

            updateSection()

            return { Set = function(v) if table.find(options, v) then selectedBtn.Text = v callback(v) end end, Get = function() return selectedBtn.Text end }
        end

        return section
    end

    return window
end

return Library
