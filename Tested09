-- ArchiveXNova v2 - Complete Draggable GUI Library
-- Copy-paste ready | 100% Working

local Library = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-- ─── UTILITY ───
local function tween(obj, info, props)
    TweenService:Create(obj, info or TweenInfo.new(0.2), props):Play()
end

local function createCorner(parent, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 8)
    corner.Parent = parent
    return corner
end

local function createStroke(parent, thickness, color)
    local stroke = Instance.new("UIStroke")
    stroke.Thickness = thickness or 1
    stroke.Color = color or Color3.fromRGB(60, 60, 70)
    stroke.Parent = parent
    return stroke
end

-- ─── DRAGGABLE ───
local function makeDraggable(frame)
    local dragging, dragStart, startPos, dragObj
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            dragObj = input
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragObj = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragObj then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
end

-- ─── CREATE WINDOW ───
function Library:CreateWindow(config)
    config = config or {}
    local title = config.Title or "ArchiveXNova v2"
    
    -- ScreenGui
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ArchiveXNova"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    
    -- Main Window
    local window = Instance.new("Frame")
    window.Name = "Window"
    window.Size = UDim2.new(0, 320, 0, 420)
    window.Position = UDim2.new(0.5, -160, 0.5, -210)
    window.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    window.BorderSizePixel = 0
    window.ClipsDescendants = true
    window.Parent = screenGui
    
    createCorner(window, 12)
    createStroke(window, 2)
    
    -- Title Bar
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, 0, 0, 36)
    titleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    titleBar.BorderSizePixel = 0
    titleBar.Parent = window
    
    createCorner(titleBar, 12)
    createStroke(titleBar, 1)
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -48, 1, 0)
    titleLabel.Position = UDim2.new(0, 14, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextSize = 15
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleBar
    
    -- Close Button
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 32, 0, 32)
    closeBtn.Position = UDim2.new(1, -36, 0, 2)
    closeBtn.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    closeBtn.Text = "✕"
    closeBtn.TextColor3 = Color3.new(1,1,1)
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 18
    closeBtn.Parent = titleBar
    
    createCorner(closeBtn, 8)
    
    closeBtn.MouseButton1Click:Connect(function()
        tween(window, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Position = UDim2.new(0.5, -160, 1.5, 0),
            Size = UDim2.new(0, 0, 0, 0)
        })
        game:GetService("Debris"):AddItem(screenGui, 0.5)
    end)
    
    -- Content ScrollingFrame
    local contentFrame = Instance.new("ScrollingFrame")
    contentFrame.Name = "Content"
    contentFrame.Size = UDim2.new(1, -20, 1, -52)
    contentFrame.Position = UDim2.new(0, 10, 0, 46)
    contentFrame.BackgroundTransparency = 1
    contentFrame.ScrollBarThickness = 6
    contentFrame.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 90)
    contentFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    contentFrame.Parent = window
    
    local uiList = Instance.new("UIListLayout")
    uiList.Padding = UDim.new(0, 10)
    uiList.SortOrder = Enum.SortOrder.LayoutOrder
    uiList.Parent = contentFrame
    
    local padding = Instance.new("UIPadding")
    padding.PaddingLeft = UDim.new(0, 12)
    padding.PaddingRight = UDim.new(0, 12)
    padding.PaddingTop = UDim.new(0, 10)
    padding.PaddingBottom = UDim.new(0, 20)
    padding.Parent = contentFrame
    
    -- Auto-resize canvas
    local function updateCanvas()
        contentFrame.CanvasSize = UDim2.new(0, 0, 0, uiList.AbsoluteContentSize.Y + 20)
    end
    uiList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvas)
    
    -- Make draggable
    makeDraggable(titleBar)
    
    -- ─── WINDOW API ───
    local windowAPI = {}
    
    function windowAPI:Section(name)
        -- Section Container
        local section = Instance.new("Frame")
        section.Name = name:gsub(" ", "") .. "Section"
        section.Size = UDim2.new(1, 0, 0, 0)
        section.BackgroundTransparency = 1
        section.Parent = contentFrame
        
        -- Section Title
        local sectionTitle = Instance.new("TextLabel")
        sectionTitle.Size = UDim2.new(1, 0, 0, 28)
        sectionTitle.BackgroundTransparency = 1
        sectionTitle.Text = name
        sectionTitle.TextColor3 = Color3.fromRGB(180, 200, 255)
        sectionTitle.TextSize = 16
        sectionTitle.Font = Enum.Font.GothamBold
        sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
        sectionTitle.Parent = section
        
        -- Elements Frame
        local elements = Instance.new("Frame")
        elements.Name = "Elements"
        elements.Size = UDim2.new(1, 0, 1, -32)
        elements.Position = UDim2.new(0, 0, 0, 28)
        elements.BackgroundTransparency = 1
        elements.Parent = section
        
        local elementList = Instance.new("UIListLayout")
        elementList.Padding = UDim.new(0, 8)
        elementList.SortOrder = Enum.SortOrder.LayoutOrder
        elementList.Parent = elements
        
        -- ─── SECTION API ───
        local sectionAPI = {}
        
        -- Button
        function sectionAPI:Button(text, callback)
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1, 0, 0, 40)
            btn.BackgroundColor3 = Color3.fromRGB(55, 70, 170)
            btn.Text = text
            btn.TextColor3 = Color3.new(1,1,1)
            btn.Font = Enum.Font.GothamSemibold
            btn.TextSize = 14
            btn.Parent = elements
            
            createCorner(btn, 10)
            createStroke(btn, 1.5)
            
            local hoverColor = Color3.fromRGB(65, 85, 200)
            local clickColor = Color3.fromRGB(45, 60, 150)
            
            btn.MouseButton1Click:Connect(function()
                tween(btn, TweenInfo.new(0.1), {BackgroundColor3 = clickColor, Size = UDim2.new(1, -6, 0, 36)})
                callback()
                wait(0.1)
                tween(btn, TweenInfo.new(0.1), {BackgroundColor3 = hoverColor, Size = UDim2.new(1, 0, 0, 40)})
            end)
            
            btn.MouseEnter:Connect(function()
                tween(btn, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor})
            end)
            btn.MouseLeave:Connect(function()
                tween(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(55, 70, 170)})
            end)
        end
        
        -- Label
        function sectionAPI:Label(text)
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, 0, 0, 28)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Color3.fromRGB(180, 180, 200)
            label.TextSize = 14
            label.Font = Enum.Font.Gotham
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.TextYAlignment = Enum.TextYAlignment.Center
            label.Parent = elements
        end
        
        -- Toggle
        function sectionAPI:Toggle(text, default, callback)
            local toggleFrame = Instance.new("Frame")
            toggleFrame.Size = UDim2.new(1, 0, 0, 36)
            toggleFrame.BackgroundTransparency = 1
            toggleFrame.Parent = elements
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -56, 1, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Color3.fromRGB(220, 220, 230)
            label.TextSize = 14
            label.Font = Enum.Font.Gotham
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = toggleFrame
            
            local toggleBtn = Instance.new("TextButton")
            toggleBtn.Size = UDim2.new(0, 52, 0, 28)
            toggleBtn.Position = UDim2.new(1, -56, 0.5, -14)
            toggleBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
            toggleBtn.Text = ""
            toggleBtn.Parent = toggleFrame
            
            createCorner(toggleBtn, 14)
            
            local knob = Instance.new("Frame")
            knob.Size = UDim2.new(0, 22, 0, 22)
            knob.Position = UDim2.new(0, 3, 0.5, -11)
            knob.BackgroundColor3 = Color3.new(1,1,1)
            knob.Parent = toggleBtn
            
            createCorner(knob, 11)
            
            local state = default or false
            local function update(state)
                if state then
                    tween(toggleBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 170, 90)})
                    tween(knob, TweenInfo.new(0.2), {Position = UDim2.new(0, 27, 0.5, -11)})
                else
                    tween(toggleBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 60, 70)})
                    tween(knob, TweenInfo.new(0.2), {Position = UDim2.new(0, 3, 0.5, -11)})
                end
                callback(state)
            end
            
            toggleBtn.MouseButton1Click:Connect(function()
                state = not state
                update(state)
            end)
            
            if default then update(true) end
        end
        
        -- Slider
        function sectionAPI:Slider(text, min, max, default, increment, callback)
            local sliderFrame = Instance.new("Frame")
            sliderFrame.Size = UDim2.new(1, 0, 0, 60)
            sliderFrame.BackgroundTransparency = 1
            sliderFrame.Parent = elements
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, 0, 0, 24)
            label.BackgroundTransparency = 1
            label.Text = text .. ": " .. default
            label.TextColor3 = Color3.fromRGB(220, 220, 230)
            label.TextSize = 14
            label.Font = Enum.Font.Gotham
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = sliderFrame
            
            local sliderBar = Instance.new("Frame")
            sliderBar.Size = UDim2.new(1, 0, 0, 8)
            sliderBar.Position = UDim2.new(0, 0, 1, -12)
            sliderBar.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
            sliderBar.Parent = sliderFrame
            
            createCorner(sliderBar, 4)
            
            local fill = Instance.new("Frame")
            fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
            fill.BackgroundColor3 = Color3.fromRGB(55, 170, 90)
            fill.BorderSizePixel = 0
            fill.Parent = sliderBar
            
            createCorner(fill, 4)
            
            local draggingSlider = false
            sliderBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    draggingSlider = true
                end
            end)
            
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    draggingSlider = false
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if draggingSlider and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    local mousePos = input.Position.X
                    local barPos = sliderBar.AbsolutePosition.X
                    local barSize = sliderBar.AbsoluteSize.X
                    local ratio = math.clamp((mousePos - barPos) / barSize, 0, 1)
                    local value = math.floor(min + (max - min) * ratio / increment) * increment
                    
                    fill.Size = UDim2.new(ratio, 0, 1, 0)
                    label.Text = text .. ": " .. value
                    callback(value)
                end
            end)
        end
        
        -- Dropdown
        function sectionAPI:Dropdown(text, options, default, callback)
            local dropdownFrame = Instance.new("Frame")
            dropdownFrame.Size = UDim2.new(1, 0, 0, 44)
            dropdownFrame.BackgroundTransparency = 1
            dropdownFrame.Parent = elements
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, 0, 0.5, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Color3.fromRGB(200, 200, 220)
            label.TextSize = 14
            label.Font = Enum.Font.Gotham
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = dropdownFrame
            
            local dropdownBtn = Instance.new("TextButton")
            dropdownBtn.Size = UDim2.new(1, 0, 0.5, 0)
            dropdownBtn.Position = UDim2.new(0, 0, 0.5, 0)
            dropdownBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
            dropdownBtn.Text = default .. " ▼"
            dropdownBtn.TextColor3 = Color3.fromRGB(220, 220, 230)
            dropdownBtn.Font = Enum.Font.Gotham
            dropdownBtn.TextSize = 14
            dropdownBtn.Parent = dropdownFrame
            
            createCorner(dropdownBtn, 8)
            createStroke(dropdownBtn, 1.5)
            
            -- Dropdown List
            local listFrame = Instance.new("Frame")
            listFrame.Size = UDim2.new(1, 0, 0, 0)
            listFrame.Position = UDim2.new(0, 0, 1, 6)
            listFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
            listFrame.Visible = false
            listFrame.ClipsDescendants = true
            listFrame.Parent = dropdownFrame
            
            createCorner(listFrame, 8)
            createStroke(listFrame, 1)
            
            local listLayout = Instance.new("UIListLayout")
            listLayout.Padding = UDim.new(0, 2)
            listLayout.SortOrder = Enum.SortOrder.LayoutOrder
            listLayout.Parent = listFrame
            
            -- Create Options
            for i, option in ipairs(options) do
                local optionBtn = Instance.new("TextButton")
                optionBtn.Size = UDim2.new(1, 0, 0, 32)
                optionBtn.BackgroundTransparency = 1
                optionBtn.Text = "  " .. option
                optionBtn.TextColor3 = Color3.fromRGB(200, 200, 220)
                optionBtn.Font = Enum.Font.Gotham
                optionBtn.TextSize = 14
                optionBtn.LayoutOrder = i
                optionBtn.Parent = listFrame
                
                optionBtn.MouseButton1Click:Connect(function()
                    dropdownBtn.Text = option .. " ▼"
                    listFrame.Visible = false
                    callback(option)
                end)
                
                optionBtn.MouseEnter:Connect(function()
                    optionBtn.BackgroundColor3 = Color3.fromRGB(55, 55, 65)
                end)
                optionBtn.MouseLeave:Connect(function()
                    optionBtn.BackgroundTransparency = 1
                end)
            end
            
            listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                listFrame.Size = UDim2.new(1, 0, 0, listLayout.AbsoluteContentSize.Y + 4)
            end)
            
            dropdownBtn.MouseButton1Click:Connect(function()
                listFrame.Visible = not listFrame.Visible
            end)
            
            -- Close dropdown when clicking outside
            UserInputService.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 and not dropdownFrame:IsAncestorOf(game:GetService("GuiService"):GetGuiInset():GetChildren()[1]) then
                    listFrame.Visible = false
                end
            end)
        end
        
        elementList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            section.Size = UDim2.new(1, 0, 0, elementList.AbsoluteContentSize.Y + 36)
            updateCanvas()
        end)
        
        return sectionAPI
    end
    
    function windowAPI:Destroy()
        screenGui:Destroy()
    end
    
    updateCanvas()
    return windowAPI
end

return Library
